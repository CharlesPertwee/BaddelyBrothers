<odoo>
  <data>
     <record id="bb_estimate_enquiry" model="ir.actions.act_window">
        <field name="name">Enquiry</field>
        <field name="res_model">bb_estimate.estimate</field>
        <field name="view_mode">form,tree,kanban</field>
        <field name="domain">[('lead', '=', active_id)]</field>
        <field name="context">{'default_lead': active_id}</field>
     </record>
      
    <record id="bb_estimate_enquiry_list" model="ir.actions.act_window">
        <field name="name">Estimates</field>
        <field name="res_model">bb_estimate.estimate</field>
        <field name="domain">[('lead', '=', active_id)]</field>
        <field name="context">{'default_lead': active_id}</field>
    </record> 
      
    
    <record id="crm_case_form_view_oppor_pro_estimate" model="ir.ui.view">
		<field name="name">crm.lead.form.opportunity.estimate</field>
		<field name="model">crm.lead</field>
		<field name="inherit_id" ref="bb_crm.crm_case_form_view_oppor_bb"/>
		<field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                    <button string="New Estimate" name="%(bb_estimate_enquiry)d" type="action" class="oe_highlight"
                            attrs="{'invisible': ['|','&amp;',  ('probability', '=', 0), ('active', '=', False), ('typeOfLead','=','Trade Counter')]}"
                            context="{'default_lead': active_id, 'default_project': Project, 'default_partner_id': partner_id,'default_quantity_1':Quantity1,'default_quantity_2':Quantity2,'default_quantity_3':Quantity3,'default_quantity_4':Quantity4, 'default_run_on':runOn, 'default_envelope_type':enquiryEnvelopeType, 'default_flap_glue_type':enquiryEnvelopeFlaptype, 'default_tissue_lined':enquiryEnvelopeTissuelIne, 'default_windowed':enquiryEnvelopeWindow, 'default_grammage':enquiryWeightGsm, 'default_finished_size':size, 'default_working_size':size, 'default_finished_height':enquirySizeHeight, 'default_working_height':enquirySizeHeight, 'default_finished_width':enquirySizeWidth,'default_EnquiryComments':description, 'default_working_width':enquirySizeWidth }" />

                </xpath>
            <xpath expr="//field[@name='typeOfLead']" position="after">
                <field name="Project" options="{'no_create_edit': True}" domain="['|',('partner_id','=',partner_id),('partner_id','parent_of',partner_id)]"/>
            </xpath>
            <xpath expr="//notebook" position="inside">
                <page string="Estimate Details">
                    <group>
                        <field name="enquiryType" string="Enquiry Type"/>                        
                    </group>
                    <group>
                        <group>
                            <field name="Quantity1"/>
                            <field name="Quantity2"/>
                            <field name="runOn"/>
                            <field name="enquiryEnvelopeType" attrs="{'invisible':[('enquiryType','!=','Envelope Estimate')]}"/>
                            <field name="enquiryPrintEdging" attrs="{'invisible':[('enquiryType','!=','Print Estimate')]}"/>
                            <field name="enquirySizeWidth"/>
                        </group>
                        <group>
                            <field name="Quantity3"/>
                            <field name="Quantity4"/>
                            <field name="size"/>
                            <field name="enquiryEnvelopeTissuelIne" attrs="{'invisible':[('enquiryType','!=','Envelope Estimate')]}"/>
                            <field name="enquiryEnvelopeFlaptype" attrs="{'invisible':[('enquiryType','!=','Envelope Estimate')]}"/>
                            <field name="enquiryEnvelopeWindow" attrs="{'invisible':[('enquiryType','!=','Envelope Estimate')]}"/>
                            <field name="enquiryEdgeColor" attrs="{'invisible':['|',('enquiryType','!=','Print Estimate'),('enquiryPrintEdging','!=','Custom')]}"/>
                            <field name="enquirySizeHeight"/>
                        </group>
                    </group>
                    <group>
                        <field name="enquiryMaterial"/>
                        <field name="enquiryWeightGsm"/>
                        <field name="enquiryPrintOrigination" attrs="{'invisible':[('enquiryType','!=','Print Estimate')]}"/>
                    </group>
                </page>
            </xpath>
		</field>
	 </record>

      <record id="crm_case_form_view_oppor_estimate" model="ir.ui.view">
            <field name="name">crm.lead.oppor.inherited.estimate</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="sale_crm.crm_case_form_view_oppor"/>
            <field name="arch" type="xml">
                <button name="action_schedule_meeting" position="after">
                    <button class="oe_stat_button" type="action"
                            name="%(bb_estimate_enquiry_list)d" icon="fa-pencil-square-o"
                            attrs="{'invisible': [('typeOfLead','=','Trade Counter')]}"
                        >
                        <div class="o_stat_info">
                            <field name="Estimate_Count" class="o_stat_value"/>
                            <span class="o_stat_text"> Estimate(s) </span>
                        </div>
                    </button>
                </button>

                
                <xpath expr="//button[@name='%(sale_crm.sale_action_quotations_new)d']" position="replace">            
                    <button string="New Quotation" name="%(sale_crm.sale_action_quotations_new)d" type="action" class="oe_highlight"
                            attrs="{'invisible': ['|' ,'&amp;',('probability', '=', 0), ('active', '=', False),('typeOfLead','=','Bespoke')]}"
                            context="{'search_default_partner_id': partner_id,
                                      'default_partner_id': partner_id,
                                      'default_team_id': team_id,
                                      'default_campaign_id': campaign_id,
                                      'default_medium_id': medium_id,
                                      'default_origin': name,
                                      'default_source_id': source_id}"/>      
                </xpath>

                <button name="%(sale_crm.sale_action_quotations)d" position="replace">
                    <button class="oe_stat_button" type="action"
                                name="%(sale_crm.sale_action_quotations)d" icon="fa-pencil-square-o"
                                context="{'default_partner_id': partner_id, 'search_default_draft': 1, 'search_default_sent': 1}"
                                attrs="{'invisible': [('typeOfLead','=','Bespoke')]}"
                            >
                            <div class="o_stat_info">
                                <field name="sale_number" class="o_stat_value"/>
                                <span class="o_stat_text"> Quotation(s) </span>
                            </div>
                        </button>
                </button>

            </field>
         </record>
     
    
      <record id="crm_case_form_view_leads_inherit" model="ir.ui.view">
		<field name="name">bb.crm.lead.form.lead</field>
		<field name="model">crm.lead</field>
		<field name="inherit_id" ref="bb_crm.crm_case_form_view_leads_bb"/>
		<field name="arch" type="xml">
            <xpath expr="//notebook" position="inside">
                <page string="Estimate Details">
                    <group>
                        <field name="enquiryType" string="Enquiry Type"/>                        
                    </group>
                    <group>
                        <group>
                            <field name="Quantity1"/>
                            <field name="Quantity2"/>
                            <field name="runOn"/>
                            <field name="enquiryEnvelopeType" attrs="{'invisible':[('enquiryType','!=','Envelope Estimate')]}"/>
                            <field name="enquiryPrintEdging" attrs="{'invisible':[('enquiryType','!=','Print Estimate')]}"/>
                            <field name="enquiryPrintDuplex" attrs="{'invisible':[('enquiryType','!=','Print Estimate')]}"/>
                            <field name="enquirySizeWidth"/>
                        </group>
                        <group>
                            <field name="Quantity3"/>
                            <field name="Quantity4"/>
                            <field name="size"/>
                            <field name="enquiryEnvelopeTissuelIne" attrs="{'invisible':[('enquiryType','!=','Envelope Estimate')]}"/>
                            <field name="enquiryEnvelopeFlaptype" attrs="{'invisible':[('enquiryType','!=','Envelope Estimate')]}"/>
                            <field name="enquiryEnvelopeWindow" attrs="{'invisible':[('enquiryType','!=','Envelope Estimate')]}"/>
                            <field name="enquiryEdgeColor" attrs="{'invisible':['|',('enquiryType','!=','Print Estimate'),('enquiryPrintEdging','!=','Custom')]}"/>
                             <field name="enquirySizeHeight"/>
                        </group>
                    </group>
                    <group>
                        <field name="enquiryMaterial"/>
                        <field name="enquiryWeightGsm"/>
                        <field name="enquiryPrintOrigination" attrs="{'invisible':[('enquiryType','!=','Print Estimate')]}"/>
                    </group>
                </page>
            </xpath>            
		</field>
	 </record>	
      
      <template id="assets_backend" name="mrp assets" inherit_id="web.assets_backend">
            <xpath expr="." position="inside">
                <script type="text/javascript" src="/bb_estimate/static/src/js/lead_conversion_analysis.js"></script>
            </xpath>
       </template>
      
    
      
  </data>
</odoo>
